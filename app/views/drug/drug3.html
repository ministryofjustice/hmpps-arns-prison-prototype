{% extends "layouts/main.html" %}

{% set pageName="Test" %}

{% block content %}
<div class="govuk-width-container" style="margin-top: -80px;">
  <main class="govuk-main-wrapper app-container govuk-body" id="main-content">
    <div class="govuk-width-container">
      <div class="govuk-grid-row user-feedback">
        <div class="govuk-grid-column-full">
          <div class="govuk-phase-banner user-feedback__banner">
            <p class="govuk-phase-banner__content">
              <strong class="govuk-tag govuk-phase-banner__content__tag">
                Beta
              </strong>
              <span class="govuk-phase-banner__text">
                This is a new service - your <a class="govuk-link user-feedback__link" target="_blank" rel="noopener noreferrer" href="https://forms.office.com/pages/responsepage.aspx?id=KEeHxuZx_kGp4S6MNndq2H4ZAQmHaONKhVwe7eFdwspUMzBFS0JEOU5JOExCQVVZRjNISUMwWDA1SS4u&route=shorturl">feedback (opens in new tab)</a> will help us improve it.
              </span>
            </p>
          </div>
        </div>
      </div>
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full offender-details">
          <span style="color: #505A5F; margin: 10px 0; display: block;">
            CRN: X769773 | PNC: 01/17658481A | Date of birth: 02 October 1969
          </span>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; margin-top: 10px;">
            <h3 class="govuk-heading-m" style="margin-bottom: 0;">Vincenza Reichel</h3>
            <a href="print-preview" class="govuk-link print-link">Print</a>
          </div>
          <div id="assessment-info" class="govuk-visually-hidden" data-assessment-id="88b81aaa-7af7-49ed-8843-1fad974b3e72"></div>
        </div>
      </div>
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
          <div class="form-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h1 class="govuk-heading-l form-header__title" style="margin-bottom: 0;">Strengths and needs</h1>
            <a href="https://arns-oastub-test.hmpps.service.justice.gov.uk"
               role="button"
               draggable="false"
               class="govuk-button govuk-button--secondary"
               data-module="govuk-button"
               data-ai-id="return-to-oasys"
               id="return-to-oasys"
               style="margin-bottom: 0; margin-top: 2px;">
              Return to OASys
            </a>
          </div>
          <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible form-header_hr govuk-grid-column-full" style="margin-top: 10px;">
        </div>
      </div>


      
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-one-third">
          <nav class="moj-side-navigation" aria-label="Side navigation">
            <ul class="moj-side-navigation__list" style="padding-left: 0; list-style: none;">
              <li class="moj-side-navigation__item" style="margin-bottom: 5px; padding: 8px 16px;">
                <a href="/form/1/0/current-accommodation?action=resume" style="color: #1d70b8; text-decoration: none;">Accommodation</a>
              </li>
              <li class="moj-side-navigation__item" style="margin-bottom: 5px; padding: 8px 16px;">
                <a href="/form/1/0/current-employment?action=resume" style="color: #1d70b8; text-decoration: none;">Employment and education</a>
              </li>
              <li class="moj-side-navigation__item" style="margin-bottom: 5px; padding: 8px 16px;">
                <a href="/form/1/0/finance?action=resume" style="color: #1d70b8; text-decoration: none;">Finances</a>
              </li>
              <li class="moj-side-navigation__item moj-side-navigation__item--active" style="background: #f3f2f1; font-weight: bold; border-left: 4px solid #1d70b8; margin-bottom: 5px; padding: 8px 16px;">
                <a href="/form/1/0/drug-use?action=resume" aria-current="location" class="govuk-link" tabindex="-1" aria-disabled="true" onclick="return false;" style="color: #1d70b8; text-decoration: none; font-weight: bold; cursor: default; pointer-events: none;">Drug use</a>
              </li>
              <li class="moj-side-navigation__item" style="margin-bottom: 5px; padding: 8px 16px;">
                <a href="/form/1/0/alcohol?action=resume" style="color: #1d70b8; text-decoration: none;">Alcohol use</a>
              </li>
              <li class="moj-side-navigation__item" style="margin-bottom: 5px; padding: 8px 16px;">
                <a href="/form/1/0/health-wellbeing?action=resume" style="color: #1d70b8; text-decoration: none;">Health and wellbeing</a>
              </li>
              <li class="moj-side-navigation__item" style="margin-bottom: 5px; padding: 8px 16px;">
                <a href="/form/1/0/personal-relationships-children-information?action=resume" style="color: #1d70b8; text-decoration: none;">Personal relationships and community</a>
              </li>
              <li class="moj-side-navigation__item" style="margin-bottom: 5px; padding: 8px 16px;">
                <a href="/form/1/0/thinking-behaviours-attitudes?action=resume" style="color: #1d70b8; text-decoration: none;">Thinking, behaviours and attitudes</a>
              </li>
              <li class="moj-side-navigation__item" style="margin-bottom: 5px; padding: 8px 16px;">
                <a href="/form/1/0/offence-analysis?action=resume" style="color: #1d70b8; text-decoration: none;">Offence analysis</a>
              </li>
            </ul>
          </nav>
        </div>
        <div class="govuk-grid-column-two-thirds">
          <a href="/form/1/0/drug-use" class="govuk-back-link">Back</a>
          <div class="section-heading">
            <div class="section-heading__heading" style="display: flex; justify-content: space-between; align-items: center;">
              <span class="govuk-caption-l">Drug use</span>
              <strong class="govuk-tag govuk-tag--grey" style="align-self: center;">Incomplete</strong>
            </div>
            <h2 class="govuk-heading-l" style="margin-bottom: 0;">Drug use background</h2>
          </div>
          <br>
          <div class="govuk-!-width-three-quarters">
            <form id="form" method="post" action="#">
              <div id="drugs-section"></div>
              <div class="questiongroup-action-buttons">
                <button type="submit" class="govuk-button govuk-!-margin-bottom-3 govuk-!-margin-right-1" data-module="govuk-button">Save and continue</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<div class="govuk-width-container">
  <main class="govuk-main-wrapper" id="main-content">
    <div class="govuk-grid-row">
      <div class="govuk-grid-column-two-thirds">
        <div class="drugs-section">
          <div id="drugs-section"></div>
        </div>
      </div>
    </div>
  </main>
</div>

<style>
  /* Prevent line breaks in drug tickbox labels */
  .govuk-checkboxes__label {
    white-space: nowrap;
  }
  /* Prevent wrapping for the details heading, hint, and inset text by expanding the bounding box */
  .govuk-form-group.give-details-wide,
  .govuk-inset-text.no-wrap {
    width: 60vw;
    max-width: 900px;
    min-width: unset;
    padding-right: 100px;
    box-sizing: border-box;
  }
  h4.govuk-heading-m.give-details-no-wrap,
  #not_used_details-hint.no-wrap,
  .govuk-inset-text.no-wrap {
    white-space: nowrap;
    overflow-x: visible;
    display: block;
  }
  /* Ensure textareas are 80% width of their container */
  .govuk-textarea.govuk-!-width-full {
    width: 80%;
    box-sizing: border-box;
    margin-right: 0;
  }
  /* Reduce the left and right margins of the main container by 50% */
  .govuk-width-container {
    max-width: 1200px !important;
    margin-left: auto !important;
    margin-right: auto !important;
  }
  /* Move the character count line up for the treatment details textarea in both conditional reveals */
  #treatment-details-conditional-yes .grow-wrap .govuk-character-count__message,
  #treatment-details-conditional-no .grow-wrap .govuk-character-count__message {
    margin-top: -20px;
  }
</style>

<script>
// Hardcoded demo data for the three drugs and their usage
const demoDrugs = [
  { value: 'HEROIN', label: 'Heroin', usedLast6: true },
  { value: 'CANNABIS', label: 'Cannabis', usedLast6: false },
  { value: 'HALLUCINOGENICS', label: 'Hallucinogenics (including ketamine)', usedLast6: false }
];

function renderDrugsSection() {
  const container = document.getElementById('drugs-section');
  let html = '';
  // Used in the last 6 months
  html += '<h3 class="govuk-heading-m">Used in the last 6 months</h3>';
  html += '<details class="govuk-details">';
  html += '<summary class="govuk-details__summary">';
  html += '<span class="govuk-details__summary-text">';
  html += 'How to record frequency';
  html += '</span>';
  html += '</summary>';
  html += '<div class="govuk-details__text">';
  html += '<strong>Daily</strong>: uses every day or most days.<br>';
  html += '<strong>Weekly</strong>: uses once or more a week but not daily (for example, every Friday and Saturday night).<br>';
  html += '<strong>Monthly</strong>: uses once or more a month but not every week.<br>';
  html += '<strong>Occasionally</strong>: uses less than once a month.';
  html += '</div>';
  html += '</details>';
  demoDrugs.filter(d => d.usedLast6).forEach(drug => {
    html += `
      <div class="drug" id="${drug.value.toLowerCase()}">
        <h4 class="govuk-heading-m">${drug.label}</h4>
        <div class="govuk-form-group form-group give-details-wide">
          <fieldset class="govuk-fieldset">
            <legend class="govuk-fieldset__legend how_often_used_last_six_months_${drug.value.toLowerCase()} ">
              How often is Margarett using this drug?
            </legend>
            <div class="govuk-radios govuk-radios--inline" data-module="govuk-radios">
              <div class="govuk-radios__item">
                <input class="govuk-radios__input" id="how_often_used_last_six_months_${drug.value.toLowerCase()}" name="how_often_used_last_six_months_${drug.value.toLowerCase()}" type="radio" value="DAILY">
                <label class="govuk-label govuk-radios__label" for="how_often_used_last_six_months_${drug.value.toLowerCase()}">Daily</label>
              </div>
              <div class="govuk-radios__item">
                <input class="govuk-radios__input" id="how_often_used_last_six_months_${drug.value.toLowerCase()}-2" name="how_often_used_last_six_months_${drug.value.toLowerCase()}" type="radio" value="WEEKLY">
                <label class="govuk-label govuk-radios__label" for="how_often_used_last_six_months_${drug.value.toLowerCase()}-2">Weekly</label>
              </div>
              <div class="govuk-radios__item">
                <input class="govuk-radios__input" id="how_often_used_last_six_months_${drug.value.toLowerCase()}-3" name="how_often_used_last_six_months_${drug.value.toLowerCase()}" type="radio" value="MONTHLY">
                <label class="govuk-label govuk-radios__label" for="how_often_used_last_six_months_${drug.value.toLowerCase()}-3">Monthly</label>
              </div>
              <div class="govuk-radios__item">
                <input class="govuk-radios__input" id="how_often_used_last_six_months_${drug.value.toLowerCase()}-4" name="how_often_used_last_six_months_${drug.value.toLowerCase()}" type="radio" value="OCCASIONALLY">
                <label class="govuk-label govuk-radios__label" for="how_often_used_last_six_months_${drug.value.toLowerCase()}-4">Occasionally</label>
              </div>
            </div>
          </fieldset>
        </div>
        <div class="form-group">
          <div class="govuk-form-group govuk-character-count form-group give-details-wide" data-module="govuk-character-count" data-maxlength="2000">
            <label class="govuk-label how_often_used_last_six_months_${drug.value.toLowerCase()}_details " for="how_often_used_last_six_months_${drug.value.toLowerCase()}_details">Give details (optional)</label>
            <div class="grow-wrap" data-replicated-value="">
              <textarea class="govuk-textarea govuk-!-width-full govuk-js-character-count" id="how_often_used_last_six_months_${drug.value.toLowerCase()}_details" name="how_often_used_last_six_months_${drug.value.toLowerCase()}_details" rows="5" aria-describedby="how_often_used_last_six_months_${drug.value.toLowerCase()}_details-info" data-grow-wrap=""></textarea>
            </div>
            <div id="how_often_used_last_six_months_${drug.value.toLowerCase()}_details-info" class="govuk-hint govuk-character-count__message govuk-visually-hidden">You can enter up to 2000 characters</div>
            <div class="govuk-hint govuk-character-count__message govuk-character-count__status" aria-hidden="true">You have 2,000 characters remaining</div>
            <div class="govuk-character-count__sr-status govuk-visually-hidden" aria-live="polite">You have 2,000 characters remaining</div>
          </div>
        </div>
        <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
      </div>
    `;
  });
  // Not used in the last 6 months
  html += '<h3 class="govuk-heading-m">Not used in the last 6 months</h3>';
  html += `<div class="govuk-inset-text no-wrap">
    Margarett used Cannabis, Hallucinogenics (including ketamine) more than 6 months ago.
  </div>`;
  // Give details textarea
  html += `<div class="govuk-form-group govuk-character-count form-group give-details-wide" data-module="govuk-character-count" data-maxlength="2000">
    <h4 class="govuk-heading-m give-details-no-wrap">Give details about Margarett's use of these drugs</h4>
    <div id="not_used_details-hint" class="govuk-hint no-wrap">
      For example, how often they used these drugs, when they stopped using, and if their use was an issue.
    </div>
    <div class="grow-wrap" data-replicated-value="">
      <textarea class="govuk-textarea govuk-!-width-full govuk-js-character-count" id="not_used_details" name="not_used_details" rows="5" aria-describedby="not_used_details-hint"></textarea>
    </div>
    <div class="govuk-hint govuk-character-count__message govuk-character-count__status" aria-hidden="true">You have 2,000 characters remaining</div>
    <div class="govuk-character-count__sr-status govuk-visually-hidden" aria-live="polite">You have 2,000 characters remaining</div>
  </div>`;
  // Which drugs has Margarett injected?
  html += `<div class="govuk-form-group">
    <fieldset class="govuk-fieldset">
      <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
        Which drugs has Margarett injected?
      </legend>
      <div class="govuk-hint">Select all that apply.</div>
      <div class="govuk-checkboxes" data-module="govuk-checkboxes">
        <div class="govuk-checkboxes__item">
          <input class="govuk-checkboxes__input" id="injected_none" name="injected_drugs" type="checkbox" value="NONE">
          <label class="govuk-label govuk-checkboxes__label" for="injected_none">None</label>
        </div>
      </div>
      <div style="margin: 10px 0;">or</div>
      <div class="govuk-checkboxes" data-module="govuk-checkboxes">
        <div class="govuk-checkboxes__item">
          <input class="govuk-checkboxes__input" id="injected_heroin" name="injected_drugs" type="checkbox" value="HEROIN" data-aria-controls="heroin-injected-conditional" aria-expanded="false">
          <label class="govuk-label govuk-checkboxes__label" for="injected_heroin">Heroin</label>
        </div>
        <div class="govuk-checkboxes__conditional govuk-checkboxes__conditional--hidden" id="heroin-injected-conditional">
          <div class="govuk-form-group">
            <label class="govuk-label govuk-label--s" for="heroin_injected_when">When has Margarett injected this drug?</label>
            <div class="govuk-hint">Select one or both.</div>
            <div class="govuk-checkboxes" id="heroin_injected_when_group">
              <div class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="heroin_injected_last6" name="heroin_injected_when" type="checkbox" value="LAST6">
                <label class="govuk-label govuk-checkboxes__label" for="heroin_injected_last6">In the last 6 months</label>
              </div>
              <div class="govuk-checkboxes__item">
                <input class="govuk-checkboxes__input" id="heroin_injected_more6" name="heroin_injected_when" type="checkbox" value="MORE6">
                <label class="govuk-label govuk-checkboxes__label" for="heroin_injected_more6">More than 6 months ago</label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </fieldset>
  </div>`;
  // Is Margarett receiving treatment?
  html += `<div class="govuk-form-group give-details-wide">
    <fieldset class="govuk-fieldset">
      <legend class="govuk-fieldset__legend govuk-fieldset__legend--m">
        Is Margarett receiving treatment for their drug use?
      </legend>
      <div class="govuk-radios" data-module="govuk-radios">
        <div class="govuk-radios__item">
          <input class="govuk-radios__input" id="treatment_yes" name="receiving_treatment" type="radio" value="YES" data-aria-controls="treatment-details-conditional-yes" aria-expanded="false">
          <label class="govuk-label govuk-radios__label" for="treatment_yes">Yes</label>
        </div>
        <div class="govuk-radios__conditional govuk-radios__conditional--hidden" id="treatment-details-conditional-yes">
          <div class="govuk-form-group">
            <label class="govuk-label" for="treatment_details_yes">Give details</label>
            <div class="grow-wrap" data-replicated-value="">
              <textarea class="govuk-textarea govuk-!-width-full" id="treatment_details_yes" name="treatment_details_yes" rows="5"></textarea>
              <div class="govuk-hint govuk-character-count__message govuk-character-count__status" aria-hidden="true">You have 2,000 characters remaining</div>
              <div class="govuk-character-count__sr-status govuk-visually-hidden" aria-live="polite">You have 2,000 characters remaining</div>
            </div>
          </div>
        </div>
        <div class="govuk-radios__item">
          <input class="govuk-radios__input" id="treatment_no" name="receiving_treatment" type="radio" value="NO" data-aria-controls="treatment-details-conditional-no" aria-expanded="false">
          <label class="govuk-label govuk-radios__label" for="treatment_no">No</label>
        </div>
        <div class="govuk-radios__conditional govuk-radios__conditional--hidden" id="treatment-details-conditional-no">
          <div class="govuk-form-group">
            <label class="govuk-label" for="treatment_details_no">Give details (optional)</label>
            <div class="grow-wrap" data-replicated-value="">
              <textarea class="govuk-textarea govuk-!-width-full" id="treatment_details_no" name="treatment_details_no" rows="5"></textarea>
              <div class="govuk-hint govuk-character-count__message govuk-character-count__status" aria-hidden="true">You have 2,000 characters remaining</div>
              <div class="govuk-character-count__sr-status govuk-visually-hidden" aria-live="polite">You have 2,000 characters remaining</div>
            </div>
          </div>
        </div>
      </div>
    </fieldset>
  </div>`;
  container.innerHTML = html;
}
renderDrugsSection();

document.addEventListener('DOMContentLoaded', function() {
  var radios = document.getElementsByName('receiving_treatment');
  var detailsGroup = document.getElementById('treatment_details_group');
  if (radios && detailsGroup) {
    radios.forEach(function(radio) {
      radio.addEventListener('change', function() {
        if (this.value === 'YES') {
          detailsGroup.style.display = '';
        } else {
          detailsGroup.style.display = 'none';
        }
      });
    });
  }
  // Mutually exclusive logic for 'None' and 'Heroin' checkboxes
  var noneCheckbox = document.getElementById('injected_none');
  var heroinCheckbox = document.getElementById('injected_heroin');
  if (noneCheckbox && heroinCheckbox) {
    noneCheckbox.addEventListener('change', function() {
      if (noneCheckbox.checked) {
        heroinCheckbox.checked = false;
        heroinCheckbox.dispatchEvent(new Event('change', { bubbles: true }));
        heroinCheckbox.dispatchEvent(new Event('click', { bubbles: true }));
      }
    });
    heroinCheckbox.addEventListener('change', function() {
      if (heroinCheckbox.checked) {
        noneCheckbox.checked = false;
        noneCheckbox.dispatchEvent(new Event('change', { bubbles: true }));
      }
    });
  }
  var form = document.getElementById('form');
  if (form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      window.location.href = 'drug4.html';
    });
  }
  var backLink = document.querySelector('a.govuk-back-link');
  if (backLink) {
    backLink.addEventListener('click', function(e) {
      e.preventDefault();
      window.location.href = 'drug2.html';
    });
  }
});

// Prevent navigation for all side nav links
document.querySelectorAll('.moj-side-navigation a').forEach(function(link) {
  link.addEventListener('click', function(event) {
    event.preventDefault();
  });
});
</script>
{% endblock %}
